<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Quiz Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <!-- Input -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">Smart Quiz Generator</h1>
            <textarea 
                id="notesInput" 
                class="w-full h-64 p-4 border rounded"
                placeholder="Paste your notes here..."
            ></textarea>
            <div class="mt-4 flex space-x-4">
                <select id="questionLimit" class="border rounded p-2">
                    <option value="5">5 Questions</option>
                    <option value="10" selected>10 Questions</option>
                    <option value="15">15 Questions</option>
                    <option value="20">20 Questions</option>
                </select>
                <button 
                    onclick="makeQuiz()" 
                    class="flex-1 bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600"
                >
                    Create Quiz
                </button>
            </div>
        </div>

        <!-- Quiz -->
        <div id="quizDisplay" class="hidden">
            <div id="questionList" class="space-y-6">
                <!-- Questions will appear here -->
            </div>
            <button 
                onclick="checkAnswers()" 
                class="mt-6 w-full bg-green-500 text-white px-6 py-3 rounded hover:bg-green-600"
            >
                Check Answers
            </button>
        </div>
    </div>

    <script>
        const questionTemplates = {
            what: (topic) => ({
                question: `What best describes ${topic}?`,
                correctAnswer: topic.toLowerCase().includes('is') ? 
                    topic : 
                    `${topic} is a key concept in this subject`,
                wrongAnswers: [
                    `${topic} is not related to this topic`,
                    `${topic} is from a different subject`,
                    `${topic} has no connection here`
                ]
            }),
            
            understand: (topic) => ({
                question: `Which statement about ${topic} is correct?`,
                correctAnswer: `${topic} plays an important role in this subject`,
                wrongAnswers: [
                    `${topic} is not important to understand`,
                    `${topic} should be ignored in this context`,
                    `${topic} is a minor detail`
                ]
            }),
            
            explain: (topic) => ({
                question: `Why is ${topic} significant?`,
                correctAnswer: `${topic} helps explain key concepts`,
                wrongAnswers: [
                    `${topic} has no significance`,
                    `${topic} only confuses the subject`,
                    `${topic} is not actually important`
                ]
            })
        };

        function isValidTopic(word) {
            // Clean the word
            word = word.replace(/[.,!?()]/g, '').trim();
            
            // Check if it's a good topic word
            return word.length > 4 && // Must be at least 5 letters
                   /^[A-Z][a-z]+$/.test(word) && // Must start with capital, then lowercase
                   !isCommonWord(word) && // Not a common word
                   !word.includes('(') && // No parentheses
                   !word.includes(')') && 
                   !word.includes(':') && // No special characters
                   !word.includes(';');
        }

        function isCommonWord(word) {
            const commonWords = new Set([
                'what', 'when', 'where', 'why', 'how',
                'this', 'that', 'these', 'those',
                'there', 'their', 'they',
                'about', 'above', 'after', 'again',
                'could', 'should', 'would',
                'make', 'made', 'from', 'have',
                'more', 'must', 'such', 'like',
                'been', 'were', 'with'
            ]);
            return commonWords.has(word.toLowerCase());
        }

        function makeQuiz() {
            const notes = document.getElementById('notesInput').value;
            if (!notes) {
                alert('Please enter your notes first!');
                return;
            }

            // Get question limit
            const limit = parseInt(document.getElementById('questionLimit').value);

            // Split notes into sentences
            const sentences = notes.split(/[.!?]+/)
                .map(s => s.trim())
                .filter(s => s.length > 15);

            // Find good topics
            let topics = new Set();
            sentences.forEach(sentence => {
                sentence.split(' ')
                    .filter(isValidTopic)
                    .forEach(topic => topics.add(topic));
            });

            // Convert to array and limit
            topics = Array.from(topics).slice(0, Math.ceil(limit / 3));

            // Generate questions
            let questions = [];
            topics.forEach(topic => {
                Object.values(questionTemplates).forEach(template => {
                    questions.push(template(topic));
                });
            });

            // Shuffle and limit questions
            questions = questions
                .sort(() => Math.random() - 0.5)
                .slice(0, limit);

            // Display questions
            displayQuiz(questions);
        }

        function displayQuiz(questions) {
            const questionList = document.getElementById('questionList');

            // Add progress bar
            questionList.innerHTML = `
                <div class="mb-6">
                    <div class="bg-gray-200 rounded-full h-2.5 mb-2">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%" id="progressBar"></div>
                    </div>
                    <div class="text-right text-sm text-gray-600">
                        Progress: <span id="progressText">0%</span>
                    </div>
                </div>
            `;

            // Add questions
            questions.forEach((q, i) => {
                const answers = [q.correctAnswer, ...q.wrongAnswers]
                    .sort(() => Math.random() - 0.5);

                questionList.innerHTML += `
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="font-bold mb-4">Question ${i + 1} of ${questions.length}: ${q.question}</p>
                        <div class="space-y-2">
                            ${answers.map((answer, j) => `
                                <div class="flex items-center">
                                    <input type="radio" 
                                           name="q${i}" 
                                           value="${answer}"
                                           id="q${i}a${j}" 
                                           onchange="updateProgress()"
                                           class="mr-2">
                                    <label for="q${i}a${j}">${answer}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            document.getElementById('quizDisplay').classList.remove('hidden');
        }

        function updateProgress() {
            const total = document.getElementsByClassName('bg-white rounded-lg shadow p-6').length;
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            const percentage = Math.round((answered / total) * 100);
            
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}%`;
        }

        function checkAnswers() {
            const questions = document.getElementsByClassName('bg-white rounded-lg shadow p-6');
            let score = 0;
            let total = 0;

            for (let question of questions) {
                const selected = question.querySelector('input:checked');
                if (selected) {
                    total++;
                    if (selected.value.includes('key concept') || 
                        selected.value.includes('important role') || 
                        selected.value.includes('helps explain')) {
                        score++;
                    }
                }
            }

            alert(`You got ${score} out of ${total} correct!`);
        }
    </script>
</body>
</html>
