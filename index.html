<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quiz Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">AI Quiz Generator</h1>
            <textarea 
                id="notesInput" 
                class="w-full h-64 p-4 border rounded"
                placeholder="Paste any notes here - the AI will create multiple choice questions automatically!"
            ></textarea>
            <button 
                onclick="generateQuiz()" 
                class="mt-4 w-full bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600"
            >
                Generate Multiple Choice Quiz
            </button>
        </div>

        <!-- Quiz Section -->
        <div id="quizSection" class="hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">Multiple Choice Quiz</h2>
                <div id="quizContainer" class="space-y-6"></div>
                <button 
                    onclick="checkAnswers()" 
                    class="mt-6 w-full bg-green-500 text-white px-6 py-3 rounded hover:bg-green-600"
                >
                    Check Answers
                </button>
            </div>
        </div>
    </div>

    <script>
        let questions = [];

        function generateQuiz() {
            const notes = document.getElementById('notesInput').value;
            if (!notes.trim()) {
                alert('Please paste your notes first!');
                return;
            }

            // Split notes into meaningful chunks
            const sentences = notes.split(/[.!?]+/)
                .map(s => s.trim())
                .filter(s => s.length > 15);

            questions = [];
            const concepts = extractConcepts(notes);

            // Generate multiple choice questions
            sentences.forEach(sentence => {
                // Find important concepts in the sentence
                const sentenceConcepts = concepts.filter(concept => 
                    sentence.toLowerCase().includes(concept.toLowerCase())
                );

                if (sentenceConcepts.length > 0) {
                    // Create question
                    const concept = sentenceConcepts[0];
                    const wrongAnswers = generateWrongAnswers(concept, concepts, sentences);
                    
                    if (wrongAnswers.length >= 3) {
                        // Create multiple choice question
                        const question = {
                            text: createQuestionFromSentence(sentence, concept),
                            correctAnswer: getCorrectAnswer(sentence, concept),
                            options: shuffleArray([...wrongAnswers.slice(0, 3), concept])
                        };
                        questions.push(question);
                    }
                }
            });

            displayQuiz();
            document.getElementById('quizSection').classList.remove('hidden');
        }

        function extractConcepts(notes) {
            const words = notes.split(/\s+/);
            const concepts = new Set();
            
            words.forEach(word => {
                // Clean the word
                word = word.replace(/[^a-zA-Z]/g, '');
                
                // Check if it's a significant word
                if (word.length > 5 && !isCommonWord(word)) {
                    // If it starts with capital letter or is long enough
                    if (/^[A-Z]/.test(word) || word.length > 7) {
                        concepts.add(word);
                    }
                }
            });

            return Array.from(concepts);
        }

        function createQuestionFromSentence(sentence, concept) {
            // Replace the concept with a blank in the sentence
            const questionText = sentence.replace(new RegExp(concept, 'gi'), '_____');
            return `Which of the following correctly completes this statement: "${questionText}"`;
        }

        function getCorrectAnswer(sentence, concept) {
            return concept;
        }

        function generateWrongAnswers(correctAnswer, concepts, sentences) {
            // Get other concepts as wrong answers
            return concepts
                .filter(c => c !== correctAnswer)
                .sort(() => Math.random() - 0.5);
        }

        function displayQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = questions.map((q, i) => `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="font-bold mb-4">Question ${i + 1}:</p>
                    <p class="mb-4">${q.text}</p>
                    <div class="space-y-3">
                        ${q.options.map((option, j) => `
                            <div class="flex items-start">
                                <input type="radio" 
                                       id="q${i}a${j}" 
                                       name="q${i}" 
                                       value="${option}"
                                       class="mt-1 mr-3">
                                <label for="q${i}a${j}" class="leading-tight">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function checkAnswers() {
            let score = 0;
            let feedback = [];

            questions.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`)?.value;
                if (selected === q.correctAnswer) {
                    score++;
                }
                feedback.push({
                    question: q.text,
                    yourAnswer: selected || 'No answer',
                    correctAnswer: q.correctAnswer
                });
            });

            // Show results
            let message = `Score: ${score} out of ${questions.length}\n\n`;
            feedback.forEach((f, i) => {
                message += `Question ${i + 1}:\n`;
                message += `Your answer: ${f.yourAnswer}\n`;
                message += `Correct answer: ${f.correctAnswer}\n\n`;
            });

            alert(message);
        }

        function isCommonWord(word) {
            const commonWords = new Set([
                'about', 'above', 'after', 'again', 'their', 'there', 'these', 
                'those', 'which', 'while', 'would', 'because', 'could', 'should',
                'through', 'during', 'before', 'within', 'first', 'second', 'third'
            ]);
            return commonWords.has(word.toLowerCase());
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
